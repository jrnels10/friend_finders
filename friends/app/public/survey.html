<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Survey page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</head>

<body>
    <div class="container">
        <div class="jumbotron credentials">
            <h3 class="header-title text-center">Find your new best friend</h3>
        </div>
        <div class="jumbotron credentials">
            <p>Please enter your name</p>
            <input class="user-name"></input>
            <p>Please upload an image of you</p>
            <input class="user-img"></input>
            <div class="btn btn-primary start-quiz">Start survey</div>
        </div>

        <div class="survey">

            <h5 class="text-center">Please answer the questions listed below with 1 being the least likely and 5 being the most similar.</h5>

            <p>1. I was excited to start the bootcamp.</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:82%;position:relative;">
                    <iframe src="https://giphy.com/embed/MOTkF7sT8u2Z2" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>2. On a friday night, I would rather code than go out with friends.</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:75%;position:relative;">
                    <iframe src="https://giphy.com/embed/l4FGsLMGYeDcFBmgw" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>3. When I start the weekly bootcamp homework, I look like this...</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:56%;position:relative;">
                    <iframe src="https://giphy.com/embed/5Zesu5VPNGJlm" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>

            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>4. How many cups of coffee do you drink while working on coding homework?</p>
            <p class="lead m-auto">
                <div class="gif m-5 w-50">
                    <div style="width:100%;height:0;padding-bottom:75%;position:relative;">
                        <iframe src="https://giphy.com/embed/zWwngnPi6vWfe" width="100%" height="100%" style="position:absolute" frameBorder="0"
                            class="giphy-embed" allowFullScreen></iframe>
                    </div>
                </div>
                <button type="button" class="btn btn-default btn-circle q1" value="1">I drink tea
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">less than 5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">less than 10
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">coffee runs through my veins
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>5. Did you give up entire social life for the duration of the bootcamp?</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:100%;position:relative;">
                    <iframe src="https://giphy.com/embed/7nFmRxSw6AmyI" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>6. When I dont understand something in class, I hope someone else will ask my question because I am too embarrassed
                to ask.</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:76%;position:relative;">
                    <iframe src="https://giphy.com/embed/3o6MbtO7rv7ENB2SLC" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>7. During class, I'm thinking more about what I am going to eat next rather than focus on the lesson.</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:100%;position:relative;">
                    <iframe src="https://giphy.com/embed/9MJ5gV1zVOyE51X193" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>

            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>8. Coding comes easy for me.</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:51%;position:relative;">
                    <iframe src="https://giphy.com/embed/x0wfpJqZ1Qtbi" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>9. I felt weird buying school supplies for the bootcamp.</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:48%;position:relative;">
                    <iframe src="https://giphy.com/embed/TEgfDT7b59nEc" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <p>10. I am going on vacation as soon as the bootcamp is over.</p>
            <div class="gif m-5 w-50">
                <div style="width:100%;height:0;padding-bottom:75%;position:relative;">
                    <iframe src="https://giphy.com/embed/GEMf7Y1Kf2d1K" width="100%" height="100%" style="position:absolute" frameBorder="0"
                        class="giphy-embed" allowFullScreen></iframe>
                </div>
            </div>
            <p class="lead m-auto">
                <button type="button" class="btn btn-default btn-circle q1" value="1">1
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="2">2
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="3">3
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="4">4
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
                <button type="button" class="btn btn-default btn-circle q1" value="5">5
                    <i class="glyphicon glyphicon-ok"></i>
                </button>
            </p>
            <div class="text-center">
                <button type="button" class="btn btn-primary btn-submit-survey" data-toggle="modal" data-target="#exampleModal">Submit Survey</button>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content w-100">
                    <div class="modal-header">
                        <h5 class="modal-title text-center" id="exampleModalLabel">Your new Best Friend</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="jumbotron test-div h-auto">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary new-bff">Find new friend</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    $(document).ready(function () {


        if ($('.credentials').is(":visible")) {
            $('.survey').hide();
        } else {
            $('.survey').show();
        }
        $('.start-quiz').on('click', function () {
            $('.credentials').hide();
            $('.survey').show();


        })

        let questAnswArray = [];
        let questionsSurvey;
        let mansBF;

        $('.q1').on('click', function () {
            questAnswArray.push(this.value);
        })

        // survey page pulls array of friendslist to compare against user input.
        $.get('/api/friendslist', function (req, res) {
            mansBF = req;

        });

        // once user submits survey, and object is built based on their input.
        $('.btn-submit-survey').on('click', function () {
            event.preventDefault();

            // Here we grab the form elements
            questionsSurvey = {
                friendName: $(".user-name").val().trim(),
                image: $(".user-img").val(),
                questions: questAnswArray
            };
            console.log(questionsSurvey);
            console.log('mansBF: ' + mansBF)

            // Calculating the users total score
            let userTally = 0;
            for (i = 0; i < questionsSurvey.questions.length; i++) {
                userTally = userTally + parseInt(questionsSurvey.questions[i]);
            }
            console.log(userTally)


            // Calculating the total score for each of the default friends
            // begins here
            let doggo;
            let doggoArray = [];
            let mansBfArray = [];
            let counts = [];
            let index = [];

            for (i = 0; i < mansBF.length; i++) {
                // userTally = userTally + parseInt(questionsSurvey.questions[i]);
                doggo = mansBF[i];

                let dogTally = 0
                for (k = 0; k < doggo.questions.length; k++) {
                    dogTally = dogTally + parseInt(doggo.questions[k]);
                }
                console.log(doggo.friendName + ':  Dog tally: ' + dogTally + "\n")
                counts.push(dogTally);

                index[i] = {
                    friendName: mansBF[i].friendName,
                    image: mansBF[i].image,
                    questions: mansBF[i].questions,
                    dogTally: dogTally
                };
                doggoArray.push(index[i])

            }
            console.log('counts: ' + counts)
            console.log(doggoArray)

            let closest = counts.reduce(function (prev, curr) {
                return (Math.abs(curr - userTally) < Math.abs(prev - userTally) ? curr : prev);
            });
            console.log("closest number: " + closest);
            let bestFriend;
            for (i = 0; i < doggoArray.length; i++) {
                if (doggoArray[i].dogTally == closest) {
                    console.log('best friend: ' + doggoArray[i].friendName)
                    bestFriend = doggoArray[i];
                }
            };

            let userImage = $(`<div class="user float-left w-50 p-2">
                                <img class ="image-friend w-100" src="${questionsSurvey.image}">
                                </div>`);
            $('.test-div').append(userImage);


            let friendImage = $(`<div class="bf float-left w-50 p-2">
                                <img class="image-friend w-100" src="${bestFriend.image}">
                                </div>`);
            $('.test-div').append(friendImage)






            // posting to friendslist api begins here.
            // The user input hasn't been added to the friendslist array until the following happens.
            let currentURL = window.location.origin;

            $.post(currentURL + '/api/friendslist', questionsSurvey, function (data) {
                console.log('posted');

            })
            $('.user-name').val('');
            questAnswArray = [];
            console.log(questAnswArray);





        });



    })
</script>

</html>